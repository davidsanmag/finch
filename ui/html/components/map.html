{{define "footer-map-route"}}
</body>
    <script src="/static/js/htmx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script id="script-map">
        function initMap() {
            {{with .Route}}
                var origin = {lat: {{.Start.Lat}}, lng: {{.Start.Lng}}};
                var destination = {lat: {{.End.Lat}}, lng: {{.End.Lng}}};

                var map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 10,
                    center: origin
                });

                var directionsService = new google.maps.DirectionsService();
                var directionsRenderer = new google.maps.DirectionsRenderer({ map: map });

                directionsService.route({
                    origin: origin,
                    destination: destination,
                waypoints: [
                        
                            {
                                location: "52.52205000000001,13.348550000000001",
                                stopover: false
                            },
                        
                            {
                                location: "52.52059000000001,13.34225",
                                stopover: false
                            },
                        
                            {
                                location: "52.51946000000001,13.34038",
                                stopover: false
                            },
                        
                            {
                                location: "52.51952000000001,13.33828",
                                stopover: false
                            },
                        
                            {
                                location: "52.5215,13.33356",
                                stopover: false
                            },
                        
                            {
                                location: "52.522650000000006,13.329320000000001",
                                stopover: false
                            },
                        
                            {
                                location: "52.52108000000001,13.327900000000005",
                                stopover: false
                            },
                        
                            {
                                location: "52.517370000000014,13.324910000000006",
                                stopover: false
                            },
                        
                            {
                                location: "52.51545000000001,13.327050000000007",
                                stopover: false
                            },
                        
                            {
                                location: "52.51352000000001,13.330120000000008",
                                stopover: false
                            },
                        
                            {
                                location: "52.51230000000001,13.331040000000007",
                                stopover: false
                            },
                        
                            {
                                location: "52.50955000000001,13.329290000000007",
                                stopover: false
                            },
                        
                            {
                                location: "52.50663000000001,13.331240000000008",
                                stopover: false
                            },
                        
                            {
                                location: "52.50544000000002,13.333930000000006",
                                stopover: false
                            },
                        
                            {
                                location: "52.505090000000024,13.337120000000004",
                                stopover: false
                            },
                        
                            {
                                location: "52.50524000000003,13.339210000000005",
                                stopover: false
                            },
                        
                            {
                                location: "52.505180000000024,13.340650000000004",
                                stopover: false
                            },
                        
                            {
                                location: "52.50576000000002,13.34169",
                                stopover: false
                            },
                        
                            {
                                location: "52.50678000000003,13.346670000000001",
                                stopover: false
                            },
                        
                            {
                                location: "52.50765000000003,13.348770000000002",
                                stopover: false
                            },
                        
                            {
                                location: "52.50900000000003,13.349690000000002",
                                stopover: false
                            },
                        
                            {
                                location: "52.50959000000003,13.352410000000003",
                                stopover: false
                            },
                        
                            {
                                location: "52.50986000000004,13.356490000000004",
                                stopover: false
                            },
                        
                    ],
                    travelMode: 'DRIVING',
                }, function(response, status) {
                    if (status === 'OK') {
                        directionsRenderer.setDirections(response);
                    } else {
                        window.alert('Directions request failed due to ' + status);
                    }
                });
            {{end}}
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key={{.MapsAPI}}&callback=initMap" async defer></script>
</html>
{{end}}

{{define "footer-map-heatmap"}}
</body>
    <script src="/static/js/htmx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script id="script-map">
        let map, marker;
        function initMap() {
                var heatmapData = [
                    {{range.HeatmapPoints}}
                        new google.maps.LatLng({{.Lat}}, {{.Lng}}),
                    {{end}}
                ];

            var sanFrancisco = new google.maps.LatLng(37.774546, -122.433523);

            map = new google.maps.Map(document.getElementById('map'), {
              center: sanFrancisco,
              zoom: 13,
              mapTypeId: 'roadmap'
            });

            var heatmapOptions = {
                data: heatmapData,
                  dissipating: true,
                gradient: [
                    'rgba(255, 255, 255, 0)',
                    'rgba(255, 165, 0, 1)', 
                    'rgba(255, 140, 0, 1)', 
                    'rgba(255, 100, 0, 1)',
                    'rgba(255, 60, 0, 1)',
                    'rgba(255, 0, 0, 1)'    
                ],
                  map: map,
                  maxIntensity: 5,
                  opacity: 0.6,
                  radius: 20
            };

            var heatmap = new google.maps.visualization.HeatmapLayer(heatmapOptions);
            heatmap.setMap(map);
            // {{with .Route}}
            //     var origin = {lat: {{.Start.Lat}}, lng: {{.Start.Lng}}};
            //     var destination = {lat: {{.End.Lat}}, lng: {{.End.Lng}}};

            //     var map = new google.maps.Map(document.getElementById('map'), {
            //         zoom: 10,
            //         center: origin
            //     });

            //     var directionsService = new google.maps.DirectionsService();
            //     var directionsRenderer = new google.maps.DirectionsRenderer({ map: map });

            //     directionsService.route({
            //         origin: origin,
            //         destination: destination,
            //         travelMode: 'DRIVING'
            //     }, function(response, status) {
            //         if (status === 'OK') {
            //             directionsRenderer.setDirections(response);
            //         } else {
            //             window.alert('Directions request failed due to ' + status);
            //         }
            //     });
            // {{end}}
            marker = new google.maps.Marker({map});

            if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                    };
                
                marker.setPosition(pos);
                map.setCenter(pos);
                localStorage["currentLat"] = pos.lat;
                localStorage["currentLng"] = pos.lng;
            },
    
            )};

        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key={{.MapsAPI}}&callback=initMap" async defer></script>
    <script async
        src="https://maps.googleapis.com/maps/api/js?key={{.MapsAPI}}&libraries=visualization&callback=initMap">
    </script>
</html>
{{end}}

{{define "map-render"}}
	<div id="map" class="w-full h-96"></div>
{{end}}
